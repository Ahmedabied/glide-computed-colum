{
  "version": 3,
  "sources": ["../src/glide.ts", "../src/column.ts"],
  "sourcesContent": ["type ColumnType = \"string\" | \"primitive\" | \"number\" | \"image-uri\" | \"uri\";\n\nexport type StringColumnValue = { type: \"string\"; value?: string };\n\nexport type ColumnParam = {\n  name: string;\n  displayName: string;\n  type: ColumnType;\n};\n\nexport type ColumnValue =\n  | { type: \"primitive\"; value?: any }\n  | { type: \"number\"; value?: number }\n  | StringColumnValue;\n\nexport type Column = (...values: ColumnValue[]) => Promise<any | undefined>;\n\nfunction convert(x: any) {\n  if (x instanceof Date) {\n    return x.toISOString();\n  } else if (Array.isArray(x)) {\n    return x.map(convert);\n  } else {\n    return x;\n  }\n}\n\nexport async function listen(event: MessageEvent<any>, main: Column) {\n  const {\n    // origin,\n    data: { key, params },\n  } = event;\n\n  let result;\n  let error;\n  try {\n    result = await main(...params);\n  } catch (e) {\n    result = undefined;\n    try {\n      error = e.toString();\n    } catch (e) {\n      error = \"Exception can't be stringified.\";\n    }\n  }\n\n  const response: any = { key };\n  if (result !== undefined) {\n    result = convert(result);\n    response.result = { type: \"string\", value: result };\n  }\n  if (error !== undefined) {\n    response.error = error;\n  }\n\n  // TODO fix this type\n  (event.source?.postMessage as any)(response, \"*\");\n}\n\nexport type Manifest = {\n  name: string;\n  description: string;\n  author: string;\n  params: ColumnParam[];\n  result: { type: ColumnType };\n  icon: string;\n  about?: string;\n  video?: string;\n};\n\nexport type ManifestConvenient<T> = Omit<Manifest, \"params\" | \"icon\"> & {\n  params: { [Name in keyof T]: Omit<ColumnParam, \"name\"> };\n  icon?: \"glide\" | string;\n};\n\nexport type ColumnDefinition<TColumnParams> =\n  ManifestConvenient<TColumnParams> & {\n    run: Column;\n    example?: Partial<TColumnParams>;\n  };\n\nexport function column<TColumnParams>(\n  manifest: ColumnDefinition<TColumnParams>\n): ColumnDefinition<TColumnParams> & { json: string } {\n  // We run this code in node to output manifests, so check for window.\n  if (typeof window !== \"undefined\") {\n    window.addEventListener(\"message\", (e) => listen(e, manifest.run));\n  }\n\n  return {\n    ...manifest,\n    json: JSON.stringify(toStrictManifest(manifest), null, 2),\n  };\n}\n\nconst glideIcon = `\n        <svg\n          width=\"48\"\n          height=\"48\"\n          viewBox=\"0 0 26 27\"\n          fill=\"none\"\n          xmlns=\"http://www.w3.org/2000/svg\"\n        >\n          <path\n            d=\"M0 14.85L14.3 0V7.29C14.3 11.4653 11.0406 14.85 7.02 14.85H0Z\"\n            fill=\"currentColor\"\n          />\n          <path\n            d=\"M11.7 19.71C11.7 15.5347 14.9594 12.15 18.98 12.15H26L11.7 27V19.71Z\"\n            fill=\"currentColor\"\n          />\n        </svg>\n    `;\n\nconst defaultIcon = `<svg width=\"48\" height=\"48\" viewBox=\"0 0 48 48\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n<path d=\"M12.0002 34.828L2.58624 25.414C1.80524 24.633 1.80524 23.367 2.58624 22.586L12.0002 13.172L14.8292 16L6.82924 24L14.8292 32L12.0002 34.828Z\" fill=\"currentColor\"/>\n<path d=\"M36.0004 34.828L33.1714 32L41.1714 24L33.1714 16L36.0004 13.172L45.4144 22.586C46.1954 23.367 46.1954 24.633 45.4144 25.414L36.0004 34.828Z\" fill=\"currentColor\"/>\n<path d=\"M26.5485 5.57617L17.5723 41.4553L21.4527 42.4261L30.4289 6.54697L26.5485 5.57617Z\" fill=\"currentColor\"/>\n</svg>`;\n\nexport function toStrictManifest(\n  convenient: ManifestConvenient<any>\n): Manifest {\n  // We carefully pick out just the props in manifest, because more\n  // could come in from the component.\n  const { name, description, author, result, params, about, video } =\n    convenient;\n\n  let { icon = defaultIcon } = convenient;\n  if (icon === \"glide\") {\n    icon = glideIcon;\n  }\n\n  return {\n    name,\n    description,\n    author,\n    result,\n    about,\n    icon,\n    video,\n    params: Object.entries(params).map(([name, param]) => ({\n      name,\n      ...param,\n    })),\n  };\n}\n", "import * as glide from \"./glide\";\n\n// Azure Translator Proxy endpoint (Cloudflare Worker)\nconst TRANSLATE_ENDPOINT = \"https://silent-fire-a4ef.ahmed-abied.workers.dev/translate\";\n\n// Simple in-memory cache\nconst cache = new Map<string, string>();\n\n// Check if text contains Arabic characters\nfunction isArabic(text: string): boolean {\n  return /[\\u0600-\\u06FF]/.test(text);\n}\n\n// Title case helper\nfunction titleCase(str: string): string {\n  if (!str) return \"\";\n  return str\n    .toLowerCase()\n    .split(\" \")\n    .map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n    .join(\" \");\n}\n\n// Main translation function\nasync function translate(text: string, from: string, to: string): Promise<string> {\n  if (!text || !text.trim()) return \"\";\n\n  // Check cache\n  const cacheKey = `${from}:${to}:${text}`;\n  if (cache.has(cacheKey)) {\n    return cache.get(cacheKey)!;\n  }\n\n  try {\n    const response = await fetch(TRANSLATE_ENDPOINT, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify({\n        text: text,\n        from: from,\n        to: to,\n      }),\n    });\n\n    if (!response.ok) {\n      console.error(\"Translation failed:\", response.status);\n      return text; // Fallback to original\n    }\n\n    const data = await response.json();\n\n    // Worker returns { results: [\"translated text\"] }\n    if (data.results && Array.isArray(data.results) && data.results.length > 0) {\n      const result = data.results[0];\n      cache.set(cacheKey, result);\n      return result;\n    }\n\n    return text; // Fallback\n  } catch (error) {\n    console.error(\"Translation error:\", error);\n    return text; // Fallback to original\n  }\n}\n\nexport default glide.column({\n  name: \"Name Translator\",\n  description: \"Translates names between Arabic and English using Azure Translator\",\n  author: \"Ahmed Abied\",\n  about: \"Uses Azure Cognitive Services for high-quality name translation.\",\n  video: \"\",\n\n  params: {\n    language: {\n      displayName: \"Target Language\",\n      type: \"string\",\n    },\n    name: {\n      displayName: \"Name\",\n      type: \"string\",\n    },\n  },\n  result: { type: \"string\" },\n\n  async run(language, name) {\n    if (language.value === undefined || name.value === undefined) {\n      return undefined;\n    }\n\n    const targetLang = language.value.toLowerCase().trim();\n    const inputName = name.value.trim();\n\n    if (!inputName) {\n      return \"\";\n    }\n\n    // Only support en/ar\n    if (targetLang !== \"en\" && targetLang !== \"ar\") {\n      return inputName;\n    }\n\n    const inputIsArabic = isArabic(inputName);\n\n    // Already in target language\n    if (targetLang === \"en\" && !inputIsArabic) return inputName;\n    if (targetLang === \"ar\" && inputIsArabic) return inputName;\n\n    // Translate\n    if (targetLang === \"en\" && inputIsArabic) {\n      const result = await translate(inputName, \"ar\", \"en\");\n      return titleCase(result);\n    }\n\n    if (targetLang === \"ar\" && !inputIsArabic) {\n      return await translate(inputName, \"en\", \"ar\");\n    }\n\n    return inputName;\n  },\n});\n"],
  "mappings": "mBAiBA,SAASA,EAAQC,EAAQ,CACvB,OAAIA,aAAa,KACRA,EAAE,YAAY,EACZ,MAAM,QAAQA,CAAC,EACjBA,EAAE,IAAID,CAAO,EAEbC,CAEX,CAEA,eAAsBC,EAAOC,EAA0BC,EAAc,CACnE,GAAM,CAEJ,KAAM,CAAE,IAAAC,EAAK,OAAAC,CAAO,CACtB,EAAIH,EAEAI,EACAC,EACJ,GAAI,CACFD,EAAS,MAAMH,EAAK,GAAGE,CAAM,CAC/B,OAASG,EAAG,CACVF,EAAS,OACT,GAAI,CACFC,EAAQC,EAAE,SAAS,CACrB,MAAY,CACVD,EAAQ,iCACV,CACF,CAEA,IAAME,EAAgB,CAAE,IAAAL,CAAI,EACxBE,IAAW,SACbA,EAASP,EAAQO,CAAM,EACvBG,EAAS,OAAS,CAAE,KAAM,SAAU,MAAOH,CAAO,GAEhDC,IAAU,SACZE,EAAS,MAAQF,IAIlBL,EAAM,QAAQ,aAAoBO,EAAU,GAAG,CAClD,CAwBO,SAASC,EACdC,EACoD,CAEpD,OAAI,OAAO,OAAW,KACpB,OAAO,iBAAiB,UAAYH,GAAMP,EAAOO,EAAGG,EAAS,GAAG,CAAC,EAG5D,CACL,GAAGA,EACH,KAAM,KAAK,UAAUC,EAAiBD,CAAQ,EAAG,KAAM,CAAC,CAC1D,CACF,CAEA,IAAME,EAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAmBZC,EAAc;AAAA;AAAA;AAAA;AAAA,QAMb,SAASF,EACdG,EACU,CAGV,GAAM,CAAE,KAAAC,EAAM,YAAAC,EAAa,OAAAC,EAAQ,OAAAZ,EAAQ,OAAAD,EAAQ,MAAAc,EAAO,MAAAC,CAAM,EAC9DL,EAEE,CAAE,KAAAM,EAAOP,CAAY,EAAIC,EAC7B,OAAIM,IAAS,UACXA,EAAOR,GAGF,CACL,KAAAG,EACA,YAAAC,EACA,OAAAC,EACA,OAAAZ,EACA,MAAAa,EACA,KAAAE,EACA,MAAAD,EACA,OAAQ,OAAO,QAAQf,CAAM,EAAE,IAAI,CAAC,CAACW,EAAMM,CAAK,KAAO,CACrD,KAAAN,EACA,GAAGM,CACL,EAAE,CACJ,CACF,CC/IA,IAAMC,EAAqB,6DAGrBC,EAAQ,IAAI,IAGlB,SAASC,EAASC,EAAuB,CACvC,MAAO,kBAAkB,KAAKA,CAAI,CACpC,CAGA,SAASC,EAAUC,EAAqB,CACtC,OAAKA,EACEA,EACJ,YAAY,EACZ,MAAM,GAAG,EACT,IAAKC,GAASA,EAAK,OAAO,CAAC,EAAE,YAAY,EAAIA,EAAK,MAAM,CAAC,CAAC,EAC1D,KAAK,GAAG,EALM,EAMnB,CAGA,eAAeC,EAAUJ,EAAcK,EAAcC,EAA6B,CAChF,GAAI,CAACN,GAAQ,CAACA,EAAK,KAAK,EAAG,MAAO,GAGlC,IAAMO,EAAW,GAAGF,CAAI,IAAIC,CAAE,IAAIN,CAAI,GACtC,GAAIF,EAAM,IAAIS,CAAQ,EACpB,OAAOT,EAAM,IAAIS,CAAQ,EAG3B,GAAI,CACF,IAAMC,EAAW,MAAM,MAAMX,EAAoB,CAC/C,OAAQ,OACR,QAAS,CACP,eAAgB,kBAClB,EACA,KAAM,KAAK,UAAU,CACnB,KAAMG,EACN,KAAMK,EACN,GAAIC,CACN,CAAC,CACH,CAAC,EAED,GAAI,CAACE,EAAS,GACZ,eAAQ,MAAM,sBAAuBA,EAAS,MAAM,EAC7CR,EAGT,IAAMS,EAAO,MAAMD,EAAS,KAAK,EAGjC,GAAIC,EAAK,SAAW,MAAM,QAAQA,EAAK,OAAO,GAAKA,EAAK,QAAQ,OAAS,EAAG,CAC1E,IAAMC,EAASD,EAAK,QAAQ,CAAC,EAC7B,OAAAX,EAAM,IAAIS,EAAUG,CAAM,EACnBA,CACT,CAEA,OAAOV,CACT,OAASW,EAAO,CACd,eAAQ,MAAM,qBAAsBA,CAAK,EAClCX,CACT,CACF,CAEA,IAAOY,EAAcC,EAAO,CAC1B,KAAM,kBACN,YAAa,qEACb,OAAQ,cACR,MAAO,mEACP,MAAO,GAEP,OAAQ,CACN,SAAU,CACR,YAAa,kBACb,KAAM,QACR,EACA,KAAM,CACJ,YAAa,OACb,KAAM,QACR,CACF,EACA,OAAQ,CAAE,KAAM,QAAS,EAEzB,MAAM,IAAIC,EAAUC,EAAM,CACxB,GAAID,EAAS,QAAU,QAAaC,EAAK,QAAU,OACjD,OAGF,IAAMC,EAAaF,EAAS,MAAM,YAAY,EAAE,KAAK,EAC/CG,EAAYF,EAAK,MAAM,KAAK,EAElC,GAAI,CAACE,EACH,MAAO,GAIT,GAAID,IAAe,MAAQA,IAAe,KACxC,OAAOC,EAGT,IAAMC,EAAgBnB,EAASkB,CAAS,EAIxC,GADID,IAAe,MAAQ,CAACE,GACxBF,IAAe,MAAQE,EAAe,OAAOD,EAGjD,GAAID,IAAe,MAAQE,EAAe,CACxC,IAAMR,EAAS,MAAMN,EAAUa,EAAW,KAAM,IAAI,EACpD,OAAOhB,EAAUS,CAAM,CACzB,CAEA,OAAIM,IAAe,MAAQ,CAACE,EACnB,MAAMd,EAAUa,EAAW,KAAM,IAAI,EAGvCA,CACT,CACF,CAAC",
  "names": ["convert", "x", "listen", "event", "main", "key", "params", "result", "error", "e", "response", "column", "manifest", "toStrictManifest", "glideIcon", "defaultIcon", "convenient", "name", "description", "author", "about", "video", "icon", "param", "TRANSLATE_ENDPOINT", "cache", "isArabic", "text", "titleCase", "str", "word", "translate", "from", "to", "cacheKey", "response", "data", "result", "error", "column_default", "column", "language", "name", "targetLang", "inputName", "inputIsArabic"]
}
